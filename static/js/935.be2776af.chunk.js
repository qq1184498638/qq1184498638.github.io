"use strict";(self.webpackChunkantd_demo_ts=self.webpackChunkantd_demo_ts||[]).push([[935],{1935:function(e,n,t){t.r(n),t.d(n,{default:function(){return fe},useDropEnd:function(){return se}});var r,a,i,u=t(2791),o=t(47),l=t(3297),c=t(1933),d=t(6129),s=function(e){var n=(0,l.i)();return(0,c.useQuery)(["kanbans",e],(function(){return n("kanbans",{data:e})}))},m=t(3841),f=t(168),p=t(5861),v=t(7757),E=t.n(v),k=t(456),Z=function(){var e=(0,l.i)();return(0,c.useQuery)(["taskTypes"],(function(){return e("taskTypes")}))},g=t(7575),y=t(732),b=t(5033),h=t(2499),I=t(9232),x=t(3695),w=t(6106),T=t(914),C=t(8361),O=t(3099),L=t(7309),P=t(6014),j=t(7382),A=t(2209),N=t(9439),M=t(6005),R=(0,u.memo)((function(e){var n=e.kanbanId,t=(0,u.useState)(""),r=(0,N.Z)(t,2),a=r[0],i=r[1],o=(0,k.G8)((0,m.wE)()),l=o.isLoading,c=o.mutateAsync,d=(0,u.useState)(!1),s=(0,N.Z)(d,2),f=s[0],v=s[1],Z=(0,m.OP)(),g=function(){return v((function(e){return!e}))},y=function(){var e=(0,p.Z)(E().mark((function e(){return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(""),g(),e.next=4,c({projectId:Z,name:a,kanbanId:n});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return f?u.createElement(A.Z,null,u.createElement(M.Z,{disabled:l,onBlur:g,placeholder:"do some thing...",autoFocus:!0,value:a,onChange:function(e){return i(e.target.value)},onPressEnter:y})):u.createElement(L.Z,{type:"link",onClick:g},"\u521b\u5efa\u4efb\u52a1")})),F=function(e){var n=e.name,t=e.keyword;if(!t)return u.createElement(u.Fragment,null,n);var r=null===n||void 0===n?void 0:n.split(t);return u.createElement(u.Fragment,null,null===r||void 0===r?void 0:r.map((function(e,n){return u.createElement("span",{key:n},e,n===r.length-1?null:u.createElement("span",{style:{color:"#257afd"}},t))})))},S=t(1413),_=t(4925),H=t(8376),K=["children"],Q=["children"],V=["children"],W=function(e){var n=e.children,t=(0,_.Z)(e,K);return u.createElement(H.bK,t,(function(e){return u.isValidElement(n)?u.cloneElement(n,(0,S.Z)((0,S.Z)({},e.droppableProps),{},{ref:e.innerRef,provided:e})):u.createElement("div",null)}))},q=u.forwardRef((function(e,n){var t,r=e.children,a=(0,_.Z)(e,Q);return u.createElement("div",Object.assign({ref:n},a),r,null===(t=a.provided)||void 0===t?void 0:t.placeholder)})),B=function(e){var n=e.children,t=(0,_.Z)(e,V);return u.createElement(H._l,t,(function(e){return u.isValidElement(n)?u.cloneElement(n,(0,S.Z)((0,S.Z)((0,S.Z)({},e.draggableProps),e.dragHandleProps),{},{ref:e.innerRef})):u.createElement("div",null)}))},G=function(e){var n,t=e.id,r=Z().data,a=null===r||void 0===r||null===(n=r.find((function(e){return e.id===t})))||void 0===n?void 0:n.name;return a?"task"===a?u.createElement(g.Z,null):u.createElement(y.Z,null):null},X=(0,u.memo)((function(e){var n=e.kanban,t=(0,m.et)(),r=(0,o.Nr)(t,1e3),a=(0,k.Xi)(r),i=a.data,l=a.isLoading,c=null===i||void 0===i?void 0:i.filter((function(e){return e.kanbanId===n.id})),d=(0,k.A_)().startEdit,s=(0,k.Fq)((0,m.wE)()),f=s.mutateAsync;s.isLoading;return u.createElement(U,null,u.createElement(w.Z,{justify:"space-between"},u.createElement(T.Z,null,u.createElement("h1",null,n.name)),u.createElement(T.Z,null,u.createElement(D,{kanban:n}))),u.createElement(C.Z,{loading:l,active:!0,round:!0,paragraph:{rows:10}},u.createElement(J,null,u.createElement(W,{type:"Row",direction:"vertical",droppableId:"kanban"+n.id},u.createElement(q,{style:{}},null===c||void 0===c?void 0:c.map((function(e,n){return u.createElement(B,{key:e.id,draggableId:"task"+e.id,index:n},u.createElement(z,{onClick:function(){return d(e.id)},style:{}},u.createElement(F,{keyword:r.name,name:e.name}),u.createElement("div",{style:{marginBottom:0}},u.createElement(O.Z,null,u.createElement(G,{id:e.typeId}),u.createElement(L.Z,{onClick:function(n){var t;n.stopPropagation(),t=e.id,I.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u770b\u677f?",onOk:function(){var e=(0,p.Z)(E().mark((function e(){return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t);case 2:x.ZP.info("\u770b\u677f\u5220\u9664\u6210\u529f!!!");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})},type:"link"},"\u5220\u9664\u4efb\u52a1")))))})))))),u.createElement(R,{kanbanId:n.id}))})),D=function(e){var n=e.kanban,t=function(e){var n=(0,l.i)();return(0,c.useQueryClient)(),(0,c.useMutation)((function(e){return n("kanbans/".concat(e),{method:"DELETE"})}),(0,d.kd)(e))}((0,m.RW)()),r=t.mutateAsync,a=(t.isLoading,function(){var e=(0,p.Z)(E().mark((function e(){return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u770b\u677f?",onOk:function(){var e=(0,p.Z)(E().mark((function e(){return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(n.id);case 2:x.ZP.info("\u770b\u677f\u5220\u9664\u6210\u529f!!!");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),i=u.createElement(P.Z,null,u.createElement(P.Z.Item,null,u.createElement(L.Z,{onClick:a,type:"link"},"\u5220\u9664")));return u.createElement(j.Z,{overlay:i},u.createElement(L.Z,{type:"link"},u.createElement(b.Z,{style:{fontSize:18}})))},z=(0,h.Z)(A.Z)(r||(r=(0,f.Z)(["\n  .ant-card-body {\n    padding: 12px;\n  }\n  margin-bottom: .5rem;\n  cursor: pointer;\n"]))),U=h.Z.div(a||(a=(0,f.Z)(["\n  //min-width: 27rem;\n  border-radius: 6px;\n  background-color: #fff;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem 1rem;\n  height: 100%;\n  min-height: 100%;\n  overflow: auto;\n"]))),J=h.Z.div(i||(i=(0,f.Z)(["\n  //overflow: auto;\n  flex: 0 0 auto;\n\n  ::-webkit-scrollbar {\n    display: none;\n  }\n"]))),Y=t(586),$=t(3808),ee=t(5728),ne=t(4351),te=t(4247),re=function(e){var n=Z().data;return u.createElement(te.V,Object.assign({options:n||[]},e))},ae=(0,u.memo)((function(){var e=(0,m.et)(),n=(0,$.G)();return u.createElement(ee.X2,{marginBottom:3,gap:!0,style:{display:"flex",justifyContent:"start"}},u.createElement(M.Z,{style:{width:"20rem"},placeholder:"\u4eba\u7269\u540d",value:e.name,onChange:function(e){return n({name:e.target.value})}}),u.createElement(ne.o,{style:{width:"20rem"},defaultOptionName:"\u7ecf\u529e\u4eba",value:e.processorId,onChange:function(e){return n({processorId:e})}}),u.createElement(re,{style:{width:"20rem"},defaultOptionName:"\u7c7b\u578b",value:e.typeId,onChange:function(e){return n({typeId:e})}}),u.createElement(L.Z,{onClick:function(){n({typeId:void 0,processorId:void 0,tagId:void 0,name:void 0})}},"\u6e05\u9664\u5237\u9009\u5668"))})),ie=t(2832),ue=(0,u.memo)((function(){var e=(0,u.useState)(""),n=(0,N.Z)(e,2),t=n[0],r=n[1],a=(0,m.OP)(),i=function(e){var n=(0,l.i)();return(0,c.useQueryClient)(),(0,c.useMutation)((function(e){return n("kanbans",{method:"POST",data:e})}),(0,d.HZ)(e))}((0,m.RW)()).mutateAsync,o=function(){var e=(0,p.Z)(E().mark((function e(){return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({name:t,projectId:a});case 2:r("");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return u.createElement(U,null,u.createElement(M.Z,{size:"large",placeholder:"\u65b0\u5efa\u770b\u677f\u540d\u79f0",value:t,onChange:function(e){return r(e.target.value)},onPressEnter:o}))})),oe=t(4452),le=t(8413),ce={labelCol:{span:8},wrapperCol:{span:16}},de=(0,u.memo)((function(){var e=(0,oe.Z)(),n=(0,N.Z)(e,1)[0],t=(0,k.A_)(),r=t.editingTask,a=t.editingTaskId,i=t.close,o=t.isLoading,l=(0,k.G1)((0,m.wE)()),c=l.mutateAsync,d=l.isLoading,s=function(){var e=(0,p.Z)(E().mark((function e(){return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c((0,S.Z)((0,S.Z)({},r),n.getFieldsValue()));case 2:x.ZP.info("task update success!!!"),i();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,u.useEffect)((function(){n.setFieldsValue(r)}),[r,n]),u.createElement(u.Fragment,null,u.createElement(I.Z,{okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",confirmLoading:d,onCancel:function(){n.resetFields(),i()},onOk:s,title:"\u7f16\u8f91\u4efb\u52a1",visible:!!a},u.createElement(C.Z,{loading:o},u.createElement(le.Z,Object.assign({},ce,{initialValues:r,form:n}),u.createElement(le.Z.Item,{label:"\u4efb\u52a1\u540d",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"}]},u.createElement(M.Z,{placeholder:"\u4eba\u7269\u540d"})),u.createElement(le.Z.Item,{label:"\u7ecf\u529e\u4eba",name:"processorId",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7ecf\u529e\u4eba"}]},u.createElement(ne.o,{defaultOptionName:"\u7ecf\u529e\u4eba"})),u.createElement(le.Z.Item,{label:"\u7c7b\u578b",name:"typeId",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7ecf\u529e\u4eba"}]},u.createElement(re,{defaultOptionName:"\u7c7b\u578b"}))))))})),se=function(){var e=s((0,m.LK)()).data,n=(0,k.Xi)((0,m.et)()).data,t=void 0===n?[]:n,r=function(e){var n=(0,l.i)();return(0,c.useMutation)((function(e){return n("kanbans/reorder",{data:e,method:"POST"})}),(0,d.c1)(e))}((0,m.RW)()).mutate,a=(0,k.Wi)((0,m.wE)()).mutate;return(0,u.useCallback)((function(n){var i=n.source,u=n.destination,o=n.type;if(u)if("COLUMN"===o){var l=null===e||void 0===e?void 0:e[i.index].id,c=null===e||void 0===e?void 0:e[u.index].id;if(!l||!c||l===c)return;var d=u.index>i.index?"after":"before";r({fromId:l,referenceId:c,type:d})}else if("Row"===o){var s=+i.droppableId.replace("kanban",""),m=+u.droppableId.replace("kanban",""),f=t.filter((function(e){return e.kanbanId===s}))[i.index],p=t.filter((function(e){return e.kanbanId===m}))[u.index];if(!f||!p||f===p)return;a({fromId:f.id,referenceId:null===p||void 0===p?void 0:p.id,type:s===m&&u.index>i.index?"after":"before",fromKanbanId:s,toKanbanId:m})}}),[t,e,r,a])},me=(0,u.memo)((function(e){(0,o.jr)("\u770b\u677f\u5217\u8868");var n=(0,m.BA)().data,t=s((0,m.LK)()),r=t.data,a=t.isLoading,i=(0,ie.Z)(),l=(i.lg,i.xxl,se());return u.createElement(H.Z5,{onDragEnd:function(){l(arguments.length<=0?void 0:arguments[0])}},u.createElement(Y.Z,{style:{overflow:"hidden",height:"100%"}},u.createElement(w.Z,null,u.createElement(T.Z,null,u.createElement("h1",null,null===n||void 0===n?void 0:n.name,"kanban"))),u.createElement(w.Z,{justify:"start"},u.createElement(T.Z,{style:{width:"100%"}},u.createElement(ae,null))),u.createElement(C.Z,{active:!0,loading:a,round:!0,paragraph:{rows:15}},u.createElement(W,{type:"COLUMN",direction:"horizontal",droppableId:"kanban"},u.createElement(q,{style:{display:"flex",flex:1}},u.createElement(w.Z,{gutter:24,justify:"space-between",wrap:!1,style:{flex:1,overflowX:"auto"}},null===r||void 0===r?void 0:r.map((function(e,n){return u.createElement(B,{draggableId:"kanban"+e.id,index:n,key:e.id},u.createElement(T.Z,{xs:{span:24},sm:{span:12},md:{span:8},xl:{span:6}},u.createElement(X,{kanban:e})))})),u.createElement(T.Z,{xs:{span:24},sm:{span:12},md:{span:8},xl:{span:6}},u.createElement(ue,null)))))),u.createElement(de,null)))})),fe=me},3841:function(e,n,t){t.d(n,{BA:function(){return c},LK:function(){return d},OP:function(){return l},RW:function(){return m},et:function(){return s},nh:function(){return p},wE:function(){return f}});var r=t(9439),a=t(6871),i=t(6691),u=t(3808),o=t(2791),l=function(){var e,n=null===(e=(0,a.TH)().pathname.match(/projects\/(\d+)/))||void 0===e?void 0:e[1];return Number(n)},c=function(){return(0,i.m7)(l())},d=function(){return{projectId:l()}},s=function(){var e=(0,u.A)(["name","typeId","processorId","tagId"]),n=(0,r.Z)(e,2),t=n[0],a=(n[1],l());return(0,o.useMemo)((function(){return{projectId:a,typeId:Number(t.typeId)||void 0,processorId:Number(t.processorId)||void 0,tagId:Number(t.tagId)||void 0,name:t.name||void 0}}),[a,t])},m=function(){return["kanbans",d()]},f=function(){return["tasks",s()]},p=function(){var e=(0,a.TH)().pathname.split("/");return e[e.length-1]}},456:function(e,n,t){t.d(n,{A_:function(){return f},Fq:function(){return m},G1:function(){return s},G8:function(){return d},Wi:function(){return p},Xi:function(){return c}});var r=t(9439),a=t(3297),i=t(1933),u=t(6129),o=t(3808),l=t(2791),c=function(e){var n=(0,a.i)();return(0,i.useQuery)(["tasks",e],(function(){return n("tasks",{data:e})}))},d=function(e){var n=(0,a.i)();return(0,i.useMutation)((function(e){return n("tasks",{data:e,method:"POST"})}),(0,u.HZ)(e))},s=function(e){var n=(0,a.i)();return(0,i.useMutation)((function(e){return n("tasks/".concat(e.id),{data:e,method:"PATCH"})}),(0,u.k1)(e))},m=function(e){var n=(0,a.i)();return(0,i.useMutation)((function(e){return n("tasks/".concat(e),{method:"DELETE"})}),(0,u.kd)(e))},f=function(){var e=(0,o.A)(["editingTaskId"]),n=(0,r.Z)(e,2),t=n[0].editingTaskId,u=n[1],c=function(e){var n=(0,a.i)();return(0,i.useQuery)(["task",{id:e}],(function(){return n("tasks/".concat(e))}),{enabled:!!e})}(Number(t)),d=c.data,s=c.isLoading,m=(0,l.useCallback)((function(e){u({editingTaskId:e})}),[u]);return{editingTaskId:t,editingTask:d,isLoading:s,close:(0,l.useCallback)((function(){u({editingTaskId:""})}),[u]),startEdit:m}},p=function(e){var n=(0,a.i)();return(0,i.useMutation)((function(e){return n("tasks/reorder",{data:e,method:"POST"})}),(0,u.R5)(e))}}}]);
//# sourceMappingURL=935.be2776af.chunk.js.map